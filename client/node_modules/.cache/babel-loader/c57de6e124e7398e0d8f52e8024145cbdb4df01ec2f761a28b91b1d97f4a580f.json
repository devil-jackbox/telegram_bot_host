{"ast":null,"code":"import _objectSpread from\"/workspace/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{useParams,Link}from'react-router-dom';import{Editor}from'@monaco-editor/react';import{Save,Play,Square,RotateCcw,FileText,AlertTriangle,Settings,Activity,Clock,Maximize2,Minimize2,Plus,Trash2,RefreshCw,Eye,EyeOff,Copy}from'lucide-react';import{useBots}from'../contexts/BotContext';import{useSocket}from'../contexts/SocketContext';import{toast}from'react-hot-toast';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const BotEditor=()=>{const{botId}=useParams();const{bots,getBot,getBotFile,updateBotFile,startBot,stopBot,updateBot}=useBots();const{joinBotRoom,leaveBotRoom}=useSocket();const[code,setCode]=useState('');const[originalCode,setOriginalCode]=useState('');const[loading,setLoading]=useState(true);const[saving,setSaving]=useState(false);const[bot,setBot]=useState(null);const[activeTab,setActiveTab]=useState('editor');const[logs,setLogs]=useState([]);const[errors,setErrors]=useState([]);const[isFullscreen,setIsFullscreen]=useState(false);const[editorInstance,setEditorInstance]=useState(null);const[environmentVariables,setEnvironmentVariables]=useState([{key:'BOT_TOKEN',value:'',isSecret:true},{key:'BOT_MODE',value:'polling',isSecret:false},{key:'PROTECT_CONTENT',value:'false',isSecret:false}]);const[autoDetectEnabled,setAutoDetectEnabled]=useState(true);const isAndroid=typeof navigator!=='undefined'&&/Android/i.test(navigator.userAgent||'');const commonEnvVars=['BOT_TOKEN','NODE_ENV','BOT_MODE','PROTECT_CONTENT','WEBHOOK_URL','PORT','DATABASE_URL','REDIS_URL','API_KEY','SECRET_KEY','ACCESS_TOKEN','REFRESH_TOKEN','CLIENT_ID','CLIENT_SECRET','WEBHOOK_SECRET','LOG_LEVEL','DEBUG','ENVIRONMENT','REGION','TIMEZONE','LANGUAGE'];const[showSecrets,setShowSecrets]=useState(false);const[hasError,setHasError]=useState(false);useEffect(()=>{if(botId){try{joinBotRoom(botId);loadBotData();}catch(error){console.error('Error in useEffect:',error);setHasError(true);setLoading(false);}}return()=>{if(botId){try{leaveBotRoom(botId);}catch(error){console.error('Error leaving bot room:',error);}}};},[botId,bots]);useEffect(()=>{if(!botId)return;const handleBotStatus=data=>{if(data.botId===botId){console.log('Bot status update:',data);setBot(prevBot=>prevBot?_objectSpread(_objectSpread({},prevBot),{},{status:data.status}):prevBot);}};const handleBotLog=data=>{if(data.botId===botId){setLogs(prevLogs=>[...prevLogs,data.log]);}};const handleBotError=data=>{if(data.botId===botId){setErrors(prevErrors=>[...prevErrors,data.error]);}};const socket=window.socket||null;if(socket){socket.on('bot-status',handleBotStatus);socket.on('bot-log',handleBotLog);socket.on('bot-error',handleBotError);return()=>{socket.off('bot-status',handleBotStatus);socket.off('bot-log',handleBotLog);socket.off('bot-error',handleBotError);};}},[botId]);useEffect(()=>{const handleKeyDown=e=>{if(e.key==='F11'&&activeTab==='editor'){e.preventDefault();toggleFullscreen();}};document.addEventListener('keydown',handleKeyDown);return()=>document.removeEventListener('keydown',handleKeyDown);},[activeTab]);useEffect(()=>{if(!autoDetectEnabled||!code||code===originalCode)return;const timer=setTimeout(()=>{if(code.length>50){const patterns=[/process\\.env\\.([A-Z_][A-Z0-9_]*)/g,/process\\.env\\[['\"`]([A-Z_][A-Z0-9_]*)['\"`]\\]/g,/process\\.env\\[`([A-Z_][A-Z0-9_]*)`\\]/g,/process\\.env\\[([A-Z_][A-Z0-9_]*)\\]/g];const detectedVars=new Set();patterns.forEach(pattern=>{let match;while((match=pattern.exec(code))!==null){const varName=match[1];if(varName&&varName.length>0){detectedVars.add(varName);}}});const commonBuiltins=['NODE_ENV','PATH','HOME','USER','PWD','SHELL','LANG','TZ'];const newVars=Array.from(detectedVars).filter(varName=>!commonBuiltins.includes(varName)&&varName.length>1).filter(varName=>!environmentVariables.some(existing=>existing.key===varName));if(newVars.length>0){const envVarsToAdd=newVars.map(varName=>{const secretKeywords=['token','secret','key','password','pass','auth','private'];const isSecret=secretKeywords.some(keyword=>varName.toLowerCase().includes(keyword));let defaultValue='';if(varName==='BOT_TOKEN'||varName==='TOKEN'){defaultValue=(bot===null||bot===void 0?void 0:bot.token)||'';}else if(varName==='NODE_ENV'){defaultValue='production';}else if(varName==='PORT'){defaultValue='3000';}else if(varName==='BOT_MODE'){defaultValue='polling';}return{key:varName,value:defaultValue,isSecret};});setEnvironmentVariables(prev=>[...prev,...envVarsToAdd]);toast.success(\"Auto-detected \".concat(envVarsToAdd.length,\" new environment variables\"));}}},2000);return()=>clearTimeout(timer);},[code,autoDetectEnabled,environmentVariables,originalCode,bot===null||bot===void 0?void 0:bot.token]);const loadBotData=async()=>{setLoading(true);try{let currentBot=bots.find(b=>b.id===botId);if(!currentBot){currentBot=await getBot(botId);}if(currentBot){setBot(currentBot);// Load bot code\nconst fileData=await getBotFile(botId);const botCode=fileData.content||'';setCode(botCode);setOriginalCode(botCode);if(currentBot.environmentVariables&&Array.isArray(currentBot.environmentVariables)){const referencesProtect=/process\\.env\\.PROTECT_CONTENT|process\\.env\\[['\"`]PROTECT_CONTENT['\"`]\\]/.test(botCode);const filtered=referencesProtect?currentBot.environmentVariables:currentBot.environmentVariables.filter(v=>v.key!=='PROTECT_CONTENT');setEnvironmentVariables(filtered);}else{setEnvironmentVariables([{key:'BOT_TOKEN',value:currentBot.token||'',isSecret:true},{key:'NODE_ENV',value:'production',isSecret:false},{key:'BOT_MODE',value:'polling',isSecret:false}]);}}}catch(error){console.error('Failed to load bot data:',error);toast.error('Failed to load bot data');}finally{setLoading(false);}};const handleSave=async()=>{if(code===originalCode)return;setSaving(true);try{await updateBotFile(botId,code);setOriginalCode(code);toast.success('Code saved successfully!');}catch(error){console.error('Failed to save code:',error);toast.error('Failed to save code');}finally{setSaving(false);}};const handleStart=async()=>{try{await updateBot(botId,{environmentVariables});setBot(prevBot=>_objectSpread(_objectSpread({},prevBot),{},{status:'starting'}));await startBot(botId);}catch(error){console.error('Failed to start bot:',error);toast.error('Failed to start bot');setBot(prevBot=>_objectSpread(_objectSpread({},prevBot),{},{status:'stopped'}));}};const handleStop=async()=>{if(window.confirm('Are you sure you want to stop this bot?')){try{setBot(prevBot=>_objectSpread(_objectSpread({},prevBot),{},{status:'stopping'}));await stopBot(botId);}catch(error){console.error('Failed to stop bot:',error);toast.error('Failed to stop bot');setBot(prevBot=>_objectSpread(_objectSpread({},prevBot),{},{status:'running'}));}}};const handleRestart=async()=>{try{await handleStop();setTimeout(async()=>{await handleStart();},1000);}catch(error){console.error('Failed to restart bot:',error);toast.error('Failed to restart bot');}};const toggleFullscreen=()=>{setIsFullscreen(!isFullscreen);};const getLanguage=()=>{return'javascript';};const getStatusBadge=()=>{if(!bot)return null;const statusColors={running:'bg-green-100 text-green-800',stopped:'bg-gray-100 text-gray-800',starting:'bg-yellow-100 text-yellow-800',stopping:'bg-yellow-100 text-yellow-800',error:'bg-red-100 text-red-800'};return/*#__PURE__*/_jsxs(\"span\",{className:\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium \".concat(statusColors[bot.status]||statusColors.stopped),children:[/*#__PURE__*/_jsx(Activity,{size:12,className:\"mr-1\"}),bot.status||'stopped']});};const addEnvironmentVariable=()=>{try{setEnvironmentVariables([...environmentVariables,{key:'',value:'',isSecret:false}]);}catch(error){console.error('Error adding environment variable:',error);toast.error('Failed to add environment variable');}};const removeEnvironmentVariable=index=>{try{setEnvironmentVariables(environmentVariables.filter((_,i)=>i!==index));}catch(error){console.error('Error removing environment variable:',error);toast.error('Failed to remove environment variable');}};const updateEnvironmentVariable=(index,field,value)=>{try{const updated=[...environmentVariables];updated[index]=_objectSpread(_objectSpread({},updated[index]),{},{[field]:value});setEnvironmentVariables(updated);}catch(error){console.error('Error updating environment variable:',error);toast.error('Failed to update environment variable');}};const saveEnvironmentVariables=async()=>{try{await updateBot(botId,{environmentVariables});toast.success('Environment variables saved!');}catch(error){console.error('Failed to save environment variables:',error);toast.error('Failed to save environment variables');}};const autoFillEnvironmentVariables=()=>{const defaultVars=[{key:'BOT_TOKEN',value:(bot===null||bot===void 0?void 0:bot.token)||'',isSecret:true},{key:'NODE_ENV',value:'production',isSecret:false},{key:'BOT_MODE',value:'polling',isSecret:false},{key:'PORT',value:'3000',isSecret:false},{key:'LOG_LEVEL',value:'info',isSecret:false},{key:'DEBUG',value:'false',isSecret:false},{key:'WEBHOOK_URL',value:'',isSecret:false},{key:'WEBHOOK_SECRET',value:'',isSecret:true}];const existingKeys=environmentVariables.map(v=>v.key);const newVars=defaultVars.filter(v=>!existingKeys.includes(v.key));setEnvironmentVariables([...environmentVariables,...newVars]);toast.success('Default environment variables added!');};const detectEnvironmentVariablesFromCode=()=>{if(!code){toast.error('No code to analyze');return;}const patterns=[/process\\.env\\.([A-Z_][A-Z0-9_]*)/g,/process\\.env\\[['\"`]([A-Z_][A-Z0-9_]*)['\"`]\\]/g,/process\\.env\\[`([A-Z_][A-Z0-9_]*)`\\]/g,/process\\.env\\[([A-Z_][A-Z0-9_]*)\\]/g,/process\\.env\\.([a-z][a-z0-9_]*)/g,/process\\.env\\[['\"`]([a-z][a-z0-9_]*)['\"`]\\]/g,/process\\.env\\[`([a-z][a-z0-9_]*)`\\]/g,/process\\.env\\[([a-z][a-z0-9_]*)\\]/g,/process\\.env\\.([A-Za-z][A-Za-z0-9_]*)/g,/process\\.env\\[['\"`]([A-Za-z][A-Za-z0-9_]*)['\"`]\\]/g,/process\\.env\\[`([A-Za-z][A-Za-z0-9_]*)`\\]/g,/process\\.env\\[([A-Za-z][A-Za-z0-9_]*)\\]/g];const detectedVars=new Set();patterns.forEach(pattern=>{let match;while((match=pattern.exec(code))!==null){const varName=match[1];if(varName&&varName.length>0){detectedVars.add(varName);}}});const commonBuiltins=['NODE_ENV','PATH','HOME','USER','PWD','SHELL','LANG','TZ'];const filteredVars=Array.from(detectedVars).filter(varName=>!commonBuiltins.includes(varName)&&varName.length>1);if(filteredVars.length===0){toast.error('No environment variables detected in code');return;}const newVars=filteredVars.map(varName=>{const secretKeywords=['token','secret','key','password','pass','auth','private'];const isSecret=secretKeywords.some(keyword=>varName.toLowerCase().includes(keyword));let defaultValue='';if(varName==='BOT_TOKEN'||varName==='TOKEN'){defaultValue=(bot===null||bot===void 0?void 0:bot.token)||'';}else if(varName==='NODE_ENV'){defaultValue='production';}else if(varName==='PORT'){defaultValue='3000';}else if(varName==='BOT_MODE'){defaultValue='polling';}return{key:varName,value:defaultValue,isSecret:isSecret};});const existingKeys=environmentVariables.map(v=>v.key);const uniqueNewVars=newVars.filter(v=>!existingKeys.includes(v.key));if(uniqueNewVars.length===0){toast.info('All detected environment variables already exist');return;}setEnvironmentVariables([...environmentVariables,...uniqueNewVars]);toast.success(\"Detected and added \".concat(uniqueNewVars.length,\" environment variables from code!\"));};const clearErrors=()=>{setErrors([]);toast.success('Errors cleared');};const copyError=error=>{navigator.clipboard.writeText(error);toast.success('Error copied to clipboard');};const formatError=error=>{if(typeof error==='string'){return error;}return JSON.stringify(error,null,2);};if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center h-64\",children:/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600\"})});}if(hasError){return/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-12\",children:[/*#__PURE__*/_jsx(AlertTriangle,{size:48,className:\"mx-auto text-red-500 mb-4\"}),/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-semibold text-gray-900 mb-2\",children:\"Something went wrong\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 mb-4\",children:\"There was an error loading the bot editor.\"}),/*#__PURE__*/_jsx(Link,{to:\"/\",className:\"btn-primary\",children:\"Back to Dashboard\"})]});}if(!bot){return/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-12\",children:[/*#__PURE__*/_jsx(AlertTriangle,{size:48,className:\"mx-auto text-red-500 mb-4\"}),/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-semibold text-gray-900 mb-2\",children:\"Bot Not Found\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 mb-4\",children:\"The bot you're looking for doesn't exist.\"}),/*#__PURE__*/_jsx(Link,{to:\"/\",className:\"btn-primary\",children:\"Back to Dashboard\"})]});}return/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-3\",children:[/*#__PURE__*/_jsx(Link,{to:\"/\",className:\"text-primary-600 hover:text-primary-700\",children:\"\\u2190 Back to Dashboard\"}),/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold text-gray-900\",children:bot.name}),getStatusBadge()]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-gray-600 mt-1\",children:[bot.language,\" \\u2022 Created \",new Date(bot.createdAt).toLocaleDateString()]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:handleSave,disabled:saving||code===originalCode,className:\"btn-primary\",children:[/*#__PURE__*/_jsx(Save,{size:16}),saving?'Saving...':'Save']}),bot.status==='running'?/*#__PURE__*/_jsxs(\"button\",{onClick:handleStop,className:\"btn-secondary\",children:[/*#__PURE__*/_jsx(Square,{size:16}),\"Stop\"]}):/*#__PURE__*/_jsxs(\"button\",{onClick:handleStart,className:\"btn-success\",children:[/*#__PURE__*/_jsx(Play,{size:16}),\"Start\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:handleRestart,className:\"btn-secondary\",children:[/*#__PURE__*/_jsx(RotateCcw,{size:16}),\"Restart\"]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"border-b border-gray-200\",children:/*#__PURE__*/_jsxs(\"nav\",{className:\"-mb-px flex space-x-8\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setActiveTab('editor'),className:\"py-2 px-1 border-b-2 font-medium text-sm \".concat(activeTab==='editor'?'border-primary-500 text-primary-600':'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'),children:[/*#__PURE__*/_jsx(FileText,{size:16,className:\"inline mr-2\"}),\"Code Editor\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setActiveTab('environment'),className:\"py-2 px-1 border-b-2 font-medium text-sm \".concat(activeTab==='environment'?'border-primary-500 text-primary-600':'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'),children:[/*#__PURE__*/_jsx(Settings,{size:16,className:\"inline mr-2\"}),\"Environment Variables\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setActiveTab('errors'),className:\"py-2 px-1 border-b-2 font-medium text-sm \".concat(activeTab==='errors'?'border-primary-500 text-primary-600':'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'),children:[/*#__PURE__*/_jsx(AlertTriangle,{size:16,className:\"inline mr-2\"}),\"Errors (\",errors.length,\")\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setActiveTab('settings'),className:\"py-2 px-1 border-b-2 font-medium text-sm \".concat(activeTab==='settings'?'border-primary-500 text-primary-600':'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'),children:[/*#__PURE__*/_jsx(Settings,{size:16,className:\"inline mr-2\"}),\"Settings\"]})]})}),activeTab==='editor'&&/*#__PURE__*/_jsx(\"div\",{className:\"card \".concat(isFullscreen?'fixed inset-0 z-50 m-0 rounded-none':''),children:/*#__PURE__*/_jsxs(\"div\",{className:\"\".concat(isFullscreen?'h-full':'h-96',\" overflow-hidden relative\"),children:[/*#__PURE__*/_jsx(\"button\",{onClick:toggleFullscreen,className:\"absolute top-2 right-2 z-10 p-2 bg-gray-800 text-white rounded-md hover:bg-gray-700 transition-colors\",title:isFullscreen?'Exit Fullscreen':'Enter Fullscreen',children:isFullscreen?/*#__PURE__*/_jsx(Minimize2,{size:16}):/*#__PURE__*/_jsx(Maximize2,{size:16})}),isAndroid?/*#__PURE__*/_jsx(\"textarea\",{className:\"w-full h-full p-4 bg-gray-900 text-white font-mono text-sm outline-none resize-none\",value:code,onChange:e=>setCode(e.target.value),spellCheck:false,autoCorrect:\"off\",autoCapitalize:\"off\"}):/*#__PURE__*/_jsx(Editor,{height:\"100%\",language:getLanguage(),value:code,onChange:setCode,theme:\"vs-dark\",onMount:(editor,monaco)=>{setEditorInstance(editor);// Focus editor when loaded\nsetTimeout(()=>{editor.focus();},100);},options:{minimap:{enabled:false},fontSize:14,lineNumbers:'on',roundedSelection:false,scrollBeyondLastLine:true,automaticLayout:true,wordWrap:'off',folding:true,lineDecorationsWidth:10,lineNumbersMinChars:3,scrollbar:{vertical:'visible',horizontal:'visible',verticalScrollbarSize:12,horizontalScrollbarSize:12,useShadows:true},overviewRulerBorder:true,overviewRulerLanes:3,fixedOverflowWidgets:true,renderWhitespace:'selection',renderControlCharacters:false,renderLineHighlight:'all',selectOnLineNumbers:false,glyphMargin:true,useTabStops:false,insertSpaces:true,tabSize:2,detectIndentation:true,trimAutoWhitespace:true,largeFileOptimizations:true,parameterHints:{enabled:true,cycle:true},autoIndent:'full',formatOnPaste:true,formatOnType:true,// Enable keyboard shortcuts\nmultiCursorModifier:'alt',accessibilitySupport:'on',copyWithSyntaxHighlighting:true,// Mobile-friendly text selection\nselectionClipboard:false,contextmenu:true,// Mobile text selection improvements\nmouseWheelZoom:false,disableLayerHinting:true,// Disable features that interfere with text selection\nquickSuggestions:false,suggestOnTriggerCharacters:false,acceptSuggestionOnCommitCharacter:false,acceptSuggestionOnEnter:'off'}})]})}),activeTab==='environment'&&/*#__PURE__*/_jsxs(\"div\",{className:\"card p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-6\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium text-gray-900\",children:\"Environment Variables\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600\",children:\"Configure environment variables for your bot\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center mt-2\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",id:\"autoDetect\",checked:autoDetectEnabled,onChange:e=>setAutoDetectEnabled(e.target.checked),className:\"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded\"}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"autoDetect\",className:\"ml-2 block text-sm text-gray-700\",children:\"Auto-detect variables from code changes\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setShowSecrets(!showSecrets),className:\"btn-secondary\",children:[showSecrets?/*#__PURE__*/_jsx(EyeOff,{size:16}):/*#__PURE__*/_jsx(Eye,{size:16}),showSecrets?'Hide':'Show',\" Secrets\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:detectEnvironmentVariablesFromCode,className:\"btn-secondary\",children:[/*#__PURE__*/_jsx(FileText,{size:16}),\"Detect from Code\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:autoFillEnvironmentVariables,className:\"btn-secondary\",children:[/*#__PURE__*/_jsx(RefreshCw,{size:16}),\"Auto-fill Defaults\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:addEnvironmentVariable,className:\"btn-primary\",children:[/*#__PURE__*/_jsx(Plus,{size:16}),\"Add Variable\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"text-sm font-medium text-blue-900 mb-2\",children:\"\\uD83D\\uDCA1 Bot Mode Information\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-blue-800 space-y-2\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"font-medium\",children:\"\\uD83D\\uDCE1 Polling Mode (Default):\"}),/*#__PURE__*/_jsx(\"p\",{children:\"\\u2022 Bot continuously checks for new messages\"}),/*#__PURE__*/_jsx(\"p\",{children:\"\\u2022 May receive queued messages when restarted\"}),/*#__PURE__*/_jsx(\"p\",{children:\"\\u2022 Works on any hosting platform\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u2022 Set \",/*#__PURE__*/_jsx(\"code\",{className:\"bg-blue-100 px-1 rounded\",children:\"BOT_MODE=polling\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"font-medium\",children:\"\\uD83C\\uDF10 Webhook Mode:\"}),/*#__PURE__*/_jsx(\"p\",{children:\"\\u2022 Telegram sends messages directly to your bot\"}),/*#__PURE__*/_jsx(\"p\",{children:\"\\u2022 No message queuing, instant responses\"}),/*#__PURE__*/_jsx(\"p\",{children:\"\\u2022 Requires HTTPS endpoint and public URL\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u2022 Set \",/*#__PURE__*/_jsx(\"code\",{className:\"bg-blue-100 px-1 rounded\",children:\"BOT_MODE=webhook\"}),\" and \",/*#__PURE__*/_jsx(\"code\",{className:\"bg-blue-100 px-1 rounded\",children:\"WEBHOOK_URL=https://your-domain.com/webhook\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"font-medium\",children:\"\\uD83D\\uDEE1\\uFE0F Message Deduplication:\"}),/*#__PURE__*/_jsx(\"p\",{children:\"\\u2022 Automatically prevents duplicate responses\"}),/*#__PURE__*/_jsx(\"p\",{children:\"\\u2022 Built-in rate limiting (100ms between messages)\"}),/*#__PURE__*/_jsx(\"p\",{children:\"\\u2022 Memory management (keeps last 1000 processed messages)\"})]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4\",children:environmentVariables.map((envVar,index)=>{// Check if this variable is used in the current code\nconst isUsedInCode=code&&(code.includes(\"process.env.\".concat(envVar.key))||code.includes(\"process.env['\".concat(envVar.key,\"']\"))||code.includes(\"process.env[\\\"\".concat(envVar.key,\"\\\"]\"))||code.includes(\"process.env[`\".concat(envVar.key,\"`]\")));return/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-3 p-4 border rounded-lg \".concat(isUsedInCode?'border-green-200 bg-green-50':'border-gray-200'),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2 mb-2\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"relative flex-1\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Variable name (e.g., API_KEY)\",value:envVar.key,onChange:e=>updateEnvironmentVariable(index,'key',e.target.value),className:\"input\",list:\"env-var-\".concat(index)}),/*#__PURE__*/_jsx(\"datalist\",{id:\"env-var-\".concat(index),children:commonEnvVars.map((suggestion,idx)=>/*#__PURE__*/_jsx(\"option\",{value:suggestion},idx))})]}),isUsedInCode&&/*#__PURE__*/_jsx(\"span\",{className:\"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800\",children:\"Used in code\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(\"input\",{type:showSecrets||!envVar.isSecret?\"text\":\"password\",placeholder:\"Variable value\",value:envVar.value,onChange:e=>updateEnvironmentVariable(index,'value',e.target.value),className:\"input flex-1\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>updateEnvironmentVariable(index,'isSecret',!envVar.isSecret),className:\"px-3 py-2 text-sm rounded-md \".concat(envVar.isSecret?'bg-red-100 text-red-700 hover:bg-red-200':'bg-gray-100 text-gray-700 hover:bg-gray-200'),children:envVar.isSecret?'Secret':'Public'})]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>removeEnvironmentVariable(index),className:\"text-red-600 hover:text-red-800 p-2\",children:/*#__PURE__*/_jsx(Trash2,{size:16})})]},index);})}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-6 flex justify-end\",children:/*#__PURE__*/_jsxs(\"button\",{onClick:saveEnvironmentVariables,className:\"btn-primary\",children:[/*#__PURE__*/_jsx(Save,{size:16}),\"Save Environment Variables\"]})})]}),activeTab==='errors'&&/*#__PURE__*/_jsxs(\"div\",{className:\"card p-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-6\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium text-gray-900\",children:\"Bot Errors\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600\",children:\"Real-time error logs and debugging information\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center space-x-2\",children:/*#__PURE__*/_jsxs(\"button\",{onClick:clearErrors,className:\"btn-secondary\",children:[/*#__PURE__*/_jsx(RefreshCw,{size:16}),\"Clear Errors\"]})})]}),errors.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-12\",children:[/*#__PURE__*/_jsx(AlertTriangle,{size:48,className:\"mx-auto text-green-500 mb-4\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium text-gray-900 mb-2\",children:\"No Errors\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:\"Your bot is running without any errors!\"})]}):/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4\",children:errors.map((error,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"border border-red-200 rounded-lg p-4 bg-red-50\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-2\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(AlertTriangle,{size:16,className:\"text-red-600\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm font-medium text-red-800\",children:[\"Error #\",index+1]}),/*#__PURE__*/_jsx(\"span\",{className:\"text-xs text-red-600\",children:new Date().toLocaleTimeString()})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>copyError(formatError(error)),className:\"text-red-600 hover:text-red-800 p-1\",title:\"Copy error\",children:/*#__PURE__*/_jsx(Copy,{size:14})})]}),/*#__PURE__*/_jsx(\"pre\",{className:\"text-sm text-red-700 bg-red-100 p-3 rounded overflow-x-auto\",children:formatError(error)})]},index))})]}),activeTab==='settings'&&/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 lg:grid-cols-2 gap-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"card p-6\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium text-gray-900 mb-4\",children:\"Bot Information\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700\",children:\"Name\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:bot.name,onChange:e=>setBot(_objectSpread(_objectSpread({},bot),{},{name:e.target.value})),className:\"input mt-1\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700\",children:\"Language\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:bot.language,disabled:true,className:\"input mt-1 bg-gray-50\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700\",children:\"Token\"}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",value:bot.token,onChange:e=>setBot(_objectSpread(_objectSpread({},bot),{},{token:e.target.value})),className:\"input mt-1\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",id:\"autoStart\",checked:bot.autoStart,onChange:e=>setBot(_objectSpread(_objectSpread({},bot),{},{autoStart:e.target.checked})),className:\"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded\"}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"autoStart\",className:\"ml-2 block text-sm text-gray-900\",children:\"Auto-start on platform launch\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-6\",children:/*#__PURE__*/_jsx(\"button\",{onClick:async()=>{try{await updateBot(botId,{name:bot.name,token:bot.token,autoStart:bot.autoStart});toast.success('Bot settings saved!');}catch(error){console.error('Failed to update bot:',error);toast.error('Failed to save bot settings');}},className:\"btn-primary\",children:\"Save Settings\"})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"card p-6\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium text-gray-900 mb-4\",children:\"Bot Status\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-gray-600\",children:\"Status\"}),getStatusBadge()]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-gray-600\",children:\"Created\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-gray-900\",children:new Date(bot.createdAt).toLocaleString()})]}),bot.updatedAt&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-gray-600\",children:\"Last Updated\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-gray-900\",children:new Date(bot.updatedAt).toLocaleString()})]})]})]})]})]});};export default BotEditor;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}